---
interface Props {
    accessKey?: string;
}

const { accessKey = "710fa7dd-697e-454e-b5c8-8eb29c58f4a2" } = Astro.props;
---

<form class="contact-form" id="contactForm" action="https://api.web3forms.com/submit" method="POST">
    <input type="hidden" name="access_key" value={accessKey}>
    <input type="hidden" name="subject" value="New Project Inquiry from Ninja Design Studio">
    <input type="hidden" name="from_name" value="Ninja Design Studio Website">
    <input type="checkbox" name="botcheck" class="hidden" style="display: none;">
    
    <div class="form-grid">
        <div class="form-group" data-scroll-fade data-delay="1">
            <label for="name">Your Name</label>
            <input type="text" id="name" name="name" placeholder="John Doe" required data-enhanced-input>
        </div>
        <div class="form-group" data-scroll-fade data-delay="2">
            <label for="email">Email Address</label>
            <input type="email" id="email" name="email" placeholder="john@project.com" required data-enhanced-input>
        </div>
        <div class="form-group" data-scroll-fade data-delay="3">
            <label for="project">Project Name</label>
            <input type="text" id="project" name="project" placeholder="Your Project" data-enhanced-input>
        </div>
        <div class="form-group" data-scroll-fade data-delay="4">
            <label for="budget">Budget Range</label>
            <select id="budget" name="budget" data-enhanced-input>
                <option value="">Select budget</option>
                <option value="under-10k">Under $10K</option>
                <option value="10k-25k">$10K - $25K</option>
                <option value="25k-50k">$25K - $50K</option>
                <option value="50k-plus">$50K+</option>
                <option value="not-sure">Not sure yet</option>
            </select>
        </div>
        <div class="form-group full-width" data-scroll-fade data-delay="5">
            <label for="message">Tell us about your project</label>
            <textarea id="message" name="message" placeholder="What are you building? What do you need? What's your timeline?" rows="4" data-enhanced-input></textarea>
        </div>
    </div>
    <button type="submit" class="btn btn-primary form-submit" data-magnetic-strong data-ripple data-hover-glow>Send Inquiry →</button>
    <div id="formResult" class="form-result" style="display: none;"></div>
</form>

<script>
    const form = document.getElementById('contactForm') as HTMLFormElement;
    const formResult = document.getElementById('formResult');
    const submitBtn = form?.querySelector('button[type="submit"]') as HTMLButtonElement;

    form?.addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!submitBtn || !formResult) return;
        
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';

        const formData = new FormData(form);
        const object = Object.fromEntries(formData);
        const json = JSON.stringify(object);

        try {
            const response = await fetch('https://api.web3forms.com/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: json
            });

            const result = await response.json();
            
            if (result.success) {
                // Redirect to thank you page
                window.location.href = '/thank-you';
            } else {
                throw new Error(result.message || 'Something went wrong');
            }
        } catch (error) {
            formResult.style.display = 'block';
            formResult.style.background = 'rgba(255, 0, 110, 0.1)';
            formResult.style.color = 'var(--neon-pink)';
            formResult.innerHTML = '✗ Oops! Something went wrong. Please try again.';
        }

        submitBtn.textContent = 'Send Inquiry →';
        submitBtn.disabled = false;
        
        setTimeout(() => {
            formResult.style.display = 'none';
        }, 10000);
    });
</script>
