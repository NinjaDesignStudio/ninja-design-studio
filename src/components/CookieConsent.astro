---
/**
 * Cookie Consent Banner
 *
 * GDPR-compliant cookie consent with localStorage persistence.
 * Shows on first visit, remembers choice for 365 days.
 */
---

<div id="cookie-consent" class="cookie-consent" role="dialog" aria-label="Cookie consent">
  <div class="cookie-content">
    <p>
      We use cookies to enhance your experience. By continuing to visit this site, you agree to our use of cookies.
      <a href="/privacy">Learn more</a>
    </p>
    <div class="cookie-actions">
      <button id="cookie-decline" class="cookie-btn cookie-btn-secondary">Decline</button>
      <button id="cookie-accept" class="cookie-btn cookie-btn-primary">Accept</button>
    </div>
  </div>
</div>

<style>
  .cookie-consent {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 9999;
    padding: 1rem;
    background: var(--darker, #0a0a0f);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    transform: translateY(100%);
    transition: transform 0.4s ease;
  }

  .cookie-consent.visible {
    transform: translateY(0);
  }

  .cookie-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1.5rem;
    flex-wrap: wrap;
  }

  .cookie-consent p {
    margin: 0;
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.7);
    flex: 1;
    min-width: 280px;
  }

  .cookie-consent a {
    color: var(--neon-cyan, #00f5ff);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .cookie-consent a:hover {
    color: var(--neon-pink, #ff006e);
  }

  .cookie-actions {
    display: flex;
    gap: 0.75rem;
  }

  .cookie-btn {
    padding: 0.625rem 1.25rem;
    font-size: 0.875rem;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
  }

  .cookie-btn-primary {
    background: var(--neon-pink, #ff006e);
    color: white;
  }

  .cookie-btn-primary:hover {
    background: #e00060;
    transform: translateY(-1px);
  }

  .cookie-btn-secondary {
    background: transparent;
    color: rgba(255, 255, 255, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .cookie-btn-secondary:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.3);
  }

  @media (max-width: 600px) {
    .cookie-content {
      flex-direction: column;
      text-align: center;
    }

    .cookie-actions {
      width: 100%;
      justify-content: center;
    }
  }
</style>

<script>
  const COOKIE_KEY = 'ninja_cookie_consent';
  const banner = document.getElementById('cookie-consent');
  const acceptBtn = document.getElementById('cookie-accept');
  const declineBtn = document.getElementById('cookie-decline');

  function getConsent() {
    const consent = localStorage.getItem(COOKIE_KEY);
    if (!consent) return null;
    try {
      const data = JSON.parse(consent);
      // Check if consent is still valid (365 days)
      if (Date.now() - data.timestamp > 365 * 24 * 60 * 60 * 1000) {
        localStorage.removeItem(COOKIE_KEY);
        return null;
      }
      return data.accepted;
    } catch {
      return null;
    }
  }

  function setConsent(accepted: boolean) {
    localStorage.setItem(COOKIE_KEY, JSON.stringify({
      accepted,
      timestamp: Date.now()
    }));
    hideBanner();
  }

  function showBanner() {
    setTimeout(() => {
      banner?.classList.add('visible');
    }, 1000);
  }

  function hideBanner() {
    banner?.classList.remove('visible');
  }

  // Check consent on load
  if (getConsent() === null) {
    showBanner();
  }

  acceptBtn?.addEventListener('click', () => setConsent(true));
  declineBtn?.addEventListener('click', () => setConsent(false));
</script>
